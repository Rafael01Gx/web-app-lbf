import{a as S}from"./chunk-3TIWJO7N.js";import{c as Z,g as Te,h as Ve,i as Ge}from"./chunk-FMV4USTX.js";import{a as ge}from"./chunk-CNP2COBP.js";import"./chunk-KDNFE22G.js";import"./chunk-RSKOHGSK.js";import{a as oe}from"./chunk-IMUJMABS.js";import{a as ye,c as Se}from"./chunk-RUE4O575.js";import{b as Ie,c as Re,d as y}from"./chunk-T2AQUXFH.js";import{A as be,C as we,D as Ee,S as E,T as ke,b as ce,i as se,j as le,l as me,m as de,r as fe,s as Ce,t as xe,u as Oe,v as Me,w as he,x as Pe,y as ve,z as De}from"./chunk-Q23MXH7B.js";import{c as ee,d as te,g as A,h as z,j as ne}from"./chunk-2PPFUFFT.js";import{f as ie,j as re,l as ae}from"./chunk-RYRDEO54.js";import{b as pe,e as _e,p as w}from"./chunk-I3X2TQNM.js";import{k as O,l as ue}from"./chunk-RF64FGT2.js";import"./chunk-QRFH67T7.js";import"./chunk-FD6YJ6N6.js";import"./chunk-3IDK2O2Y.js";import"./chunk-FQ7V5Y7D.js";import"./chunk-E2AUU6GZ.js";import{Bc as F,Ec as X,Fb as P,Gb as B,Gc as Y,Hb as N,Ib as L,Jb as Q,Kb as g,Mb as W,Pb as R,Qb as q,Rb as U,Sb as J,Tb as r,Ub as i,Vb as f,Wb as v,Xb as D,Zb as C,bb as s,cb as I,ea as p,fc as x,hc as l,kc as K,ma as _,mc as T,na as u,nc as V,oc as G,rb as h,tc as c,vc as b,yb as d}from"./chunk-YR66D3FA.js";import{a as j,b as $}from"./chunk-EQDQRRRY.js";var $e=()=>[O,import("./chunk-SVQPS6JF.js").then(n=>n.MatButton)];function Be(n,t){if(n&1){let e=C();r(0,"div",4)(1,"button",5),x("click",function(){_(e);let a=l();return u(a.revisar())}),r(2,"mat-icon"),c(3,"check"),i(),c(4," Concluir revis\xE3o "),i()()}}var k=class n{dialogRef=p(Ie);element=p(Re);#e=p(oe);#t=p(ge);#n=p(S);revisor;ngAfterViewInit(){this.#t.httpCheckUser().subscribe(t=>{t&&(this.revisor={_id:t._id,name:t.name,area:t.area,funcao:t.funcao})})}closeDialog(){this.dialogRef.close(!0)}revisar(){let t=this.element;if(t){t.status="Finalizada",t.revisor_da_os=this.revisor;try{this.#n.httpEditarOrdemDeServico(t).subscribe(e=>{this.#e.success("Ordem de servico 'Finalizada' "),this.closeDialog()})}catch(e){console.error(e)}}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=h({type:n,selectors:[["app-revisao-de-os"]],decls:11,vars:0,consts:[["ok",""],[1,"close-bar"],[3,"click"],[1,"fter"],[1,"revisar"],["mat-raised-button","",3,"click"]],template:function(e,o){if(e&1){let a=C();r(0,"div",1)(1,"span"),c(2," Revis\xE3o"),i(),r(3,"mat-icon",2),x("click",function(){return _(a),u(o.closeDialog())}),c(4,"close"),i()(),f(5,"app-relatorio-de-analise"),d(6,Be,5,0),P(7,6,$e),N(1e4),L(9),f(9,"div",3,0)}},dependencies:[w,O,Te],styles:[".mat-mdc-dialog-surface{border-radius:5px!important;overflow:hidden;overflow-y:scroll}  .mat-mdc-dialog-surface::-webkit-scrollbar{display:none}  .mat-mdc-dialog-surface{scrollbar-width:none;-ms-overflow-style:none}[_nghost-%COMP%]   .close-bar[_ngcontent-%COMP%]{background-color:var(--blue-10);position:sticky;top:0;z-index:10;width:100%;height:25px;padding:5px;display:flex;align-items:center;justify-content:flex-end}[_nghost-%COMP%]   .close-bar[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;position:absolute;left:50%;transform:translate(-50%);align-self:center}[_nghost-%COMP%]   .close-bar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:5px;color:#fff;transition:color .1s ease-in-out}[_nghost-%COMP%]   .close-bar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]:hover{cursor:pointer;color:#d4d4d4}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{mix-blend-mode:multiply;width:50px;position:absolute;left:50%;transform:translate(-50%)}[_nghost-%COMP%]   .revisar[_ngcontent-%COMP%]{padding:5px;display:flex;justify-content:flex-end}[_nghost-%COMP%]   .revisar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:15px;border-radius:5px}[_nghost-%COMP%]   .fter[_ngcontent-%COMP%]{background-color:var(--blue-10);position:sticky;bottom:0;z-index:10;margin-top:5px;width:100%;height:10px}"]})};var Ne=()=>[se,ce,me,fe,xe,Pe,Oe,Ce,ve,Me,he,De,be,E,pe,_e,O,re,ie,import("./chunk-HXVWHJB2.js").then(n=>n.NgxMaskPipe),Ve],Le=()=>["expandedDetail"],Qe=()=>[10,30,50];function We(n,t){if(n&1&&(r(0,"th",16),c(1),i()),n&2){let e=l().$implicit;s(),b(" ",e," ")}}function qe(n,t){if(n&1&&(r(0,"td",17),c(1),i()),n&2){let e=t.$implicit,o=l().$implicit;s(),b(" ",e[o]," ")}}function Ue(n,t){if(n&1&&(v(0,6),d(1,We,2,1,"th",15)(2,qe,2,1,"td",9),D()),n&2){let e=t.$implicit;K("matColumnDef",e)}}function Je(n,t){n&1&&(r(0,"th",18),c(1,"\xA0"),i())}function Ke(n,t){n&1&&(r(0,"mat-icon"),c(1,"keyboard_arrow_up"),i())}function Xe(n,t){n&1&&(r(0,"mat-icon"),c(1,"keyboard_arrow_down"),i())}function Ye(n,t){if(n&1){let e=C();r(0,"td",17)(1,"button",19),x("click",function(a){let m=_(e).$implicit,M=l(2);return M.expandedElement=M.expandedElement===m?null:m,u(a.stopPropagation())}),d(2,Ke,2,0,"mat-icon")(3,Xe,2,0,"mat-icon"),i()()}if(n&2){let e=t.$implicit,o=l(2);s(2),R(o.expandedElement===e?2:3)}}function Ze(n,t){if(n&1){let e=C();r(0,"button",26),x("click",function(){_(e);let a=l().$implicit,m=l(2);return u(m.navegarParaRelatorio(a))}),c(1," Revisar "),r(2,"mat-icon"),c(3," check"),i()()}}function et(n,t){if(n&1&&(r(0,"td",17)(1,"div",20)(2,"div",21)(3,"mat-card-content")(4,"h2",22),c(5),X(6,"mask"),i(),r(7,"div",23)(8,"h3"),c(9,"0%"),i(),r(10,"h3"),c(11,"50%"),i(),r(12,"h3"),c(13,"100%"),i()(),f(14,"mat-progress-bar",24),i(),d(15,Ze,4,0,"button",25),i()()()),n&2){let e=t.$implicit,o=l(2);Q("colspan",o.columnsToDisplayWithExpand.length),s(),g("@detailExpand",e==o.expandedElement?"collapsed":"expanded"),s(4),b("Andamento - ",Y(6,5,e.progresso_calculado,"percent.2"),"%"),s(9),g("value",e.progresso_calculado),s(),R(e.progresso_calculado==100?15:-1)}}function tt(n,t){n&1&&f(0,"tr",27)}function nt(n,t){if(n&1){let e=C();r(0,"tr",28),x("click",function(){let a=_(e).$implicit,m=l(2);return u(m.expandedElement=m.expandedElement===a?null:a)}),i()}if(n&2){let e=t.$implicit,o=l(2);W("example-expanded-row",o.expandedElement===e)}}function ot(n,t){n&1&&f(0,"tr",29)}function it(n,t){if(n&1){let e=C();r(0,"mat-card")(1,"div",1)(2,"mat-form-field",2)(3,"mat-label"),c(4,"Filtro"),i(),r(5,"input",3,0),x("keyup",function(a){_(e);let m=l();return u(m.applyFilter(a))}),i()(),r(7,"div",4)(8,"table",5),U(9,Ue,3,1,"ng-container",6,q),v(11,7),d(12,Je,2,0,"th",8)(13,Ye,4,1,"td",9),D(),v(14,10),d(15,et,16,8,"td",9),D(),d(16,tt,1,0,"tr",11)(17,nt,1,2,"tr",12)(18,ot,1,0,"tr",13),i(),f(19,"mat-paginator",14),i()()()}if(n&2){let e=l();s(8),g("dataSource",e.dataSource),s(),J(e.displayedColumns),s(7),g("matHeaderRowDef",e.columnsToDisplayWithExpand),s(),g("matRowDefColumns",e.columnsToDisplayWithExpand),s(),g("matRowDefColumns",F(5,Le)),s(),g("pageSizeOptions",F(6,Qe))}}var Fe=class n{constructor(t,e){this.MatDialog=t;this.router=e}#e=p(S);#t=p(y);listOs=[];dataSource=new Ee(this.listOs);progresso=0;displayedColumns=["numeroOs","data_solicitacao","status"];columnsToDisplayWithExpand=[...this.displayedColumns,"expand"];expandedElement;paginator;sort;ngOnInit(){this.#e.httpListarTodasOrdensDeServico().subscribe(t=>{t&&t.ordemsDeServico?(this.listOs=t.ordemsDeServico.filter(e=>e.status=="Em Execu\xE7\xE3o"),this.listOs=this.listOs.map(e=>{let o=this.getOsProgresso(e);return $(j({},e),{progresso_calculado:o})}).sort((e,o)=>o.progresso_calculado-e.progresso_calculado),this.dataSource.data=this.listOs):console.error("Nenhuma ordem de servi\xE7o encontrada na resposta")})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}applyFilter(t){let e=t.target.value;this.dataSource.filter=e.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}getOsProgresso(t){if(!t.progresso)return 0;let e=Object.keys(t.progresso),o=e.length;return e.reduce((M,Ae)=>{let H=t.progresso[Ae];return M+(typeof H=="number"?H:0)},0)/o}getObjectKeysLength(t){return Object.keys(t).length}navegarParaRelatorio(t){sessionStorage.setItem("ordemDeServico",JSON.stringify(t));let e=this.#t.open(k,{minWidth:"25cm",minHeight:"95lvh",maxHeight:"95lvh",data:t})}static \u0275fac=function(e){return new(e||n)(I(y),I(Z))};static \u0275cmp=h({type:n,selectors:[["app-gerenciar-os-em-execucao"]],viewQuery:function(e,o){if(e&1&&(T(E,5),T(ye,5)),e&2){let a;V(a=G())&&(o.paginator=a.first),V(a=G())&&(o.sort=a.first)}},decls:3,vars:0,consts:[["input",""],[1,"tabela-container"],[1,"filter-field"],["matInput","","placeholder","",3,"keyup"],[1,"mat-elevation-z8","table-wrapper"],["mat-table","","multiTemplateDataRows","",1,"mat-elevation-z8","t-table",3,"dataSource"],[3,"matColumnDef"],["matColumnDef","expand"],["mat-header-cell","","aria-label","row actions",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","example-element-row",3,"example-expanded-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","example-detail-row",4,"matRowDef","matRowDefColumns"],["aria-label","Selecione a p\xE1gina de usu\xE1rios",1,"sticky-paginator",3,"pageSizeOptions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","","aria-label","row actions"],["mat-icon-button","","aria-label","expand row",3,"click"],[1,"detalhes"],[1,"container"],[1,"example-h2"],[1,"progress"],["mode","determinate",3,"value"],["mat-fab","","extended",""],["mat-fab","","extended","",3,"click"],["mat-header-row",""],["mat-row","",1,"example-element-row",3,"click"],["mat-row","",1,"example-detail-row"]],template:function(e,o){e&1&&(d(0,it,20,7),P(1,0,Ne),B())},dependencies:[le,de,we,Se,ke,w,ue,ae,Ge],styles:["[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]{display:flex;max-height:100%}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;overflow:hidden}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .filter-field[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .table-wrapper[_ngcontent-%COMP%]{flex-grow:1;overflow-y:auto;position:relative}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .t-table[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .t-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .t-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:hover{cursor:pointer}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .tabela-container[_ngcontent-%COMP%]   .sticky-paginator[_ngcontent-%COMP%]{position:sticky;bottom:0;z-index:10}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:var(--gray-100)}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   tr.example-detail-row[_ngcontent-%COMP%]{height:0}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   tr.example-element-row[_ngcontent-%COMP%]:not(.example-expanded-row):hover{background:#f5f5f5}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   tr.example-element-row[_ngcontent-%COMP%]:not(.example-expanded-row):active{background:#efefef}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .example-element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]{width:100%;overflow:hidden;display:flex;margin-bottom:10px;box-shadow:#0000000d 0 0 0 1px,#d1d5db 0 0 0 1px inset}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;margin:10px;display:flex;flex-direction:row;align-items:center;justify-content:start;flex-grow:1;color:var(--blue-10);line-height:24px;gap:20px}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--gray-100);border-radius:5px;box-shadow:#0000001a 0 1px 2px;color:green}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1rem}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-card[_ngcontent-%COMP%]   .detalhes[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}"],data:{animation:[ee("detailExpand",[z("collapsed,void",A({height:"0px",minHeight:"0"})),z("expanded",A({height:"*"})),ne("expanded <=> collapsed",te("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}})};export{Fe as GerenciarOsEmExecucaoComponent};
